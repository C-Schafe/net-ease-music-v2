{"version":3,"sources":["webpack:///webpack/bootstrap 4c89a87d686adeab384e","webpack:///./src/js/song-form.js"],"names":["console","log","view","el","template","render","data","placeholders","htmlString","map","string","replace","$","html","toggleNewAndEdit","id","reset","show","removeClass","hide","addClass","find","prepend","setCover","cover","attr","model","name","singer","url","lyrics","create","Song","AV","Object","extend","song","set","save","then","res","attributes","assign","error","update","createWithoutData","controller","init","bindEvents","bindEventHub","window","eventHub","on","e","preventDefault","needs","split","item","val","emit","JSON","parse","stringify","newSong"],"mappings":"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","file":"songForm.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 16);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 4c89a87d686adeab384e","console.log('song form');\r\n{\r\n    let view = {\r\n        el: '.new-song-detail',\r\n        template: `\r\n                <form class=\"form\">\r\n                    <div class=\"song-info\">\r\n                        <div class=\"picture\">\r\n                            <img src=\"\" alt=\"\">\r\n                        </div>\r\n                        <div class=\"left-rows\">\r\n                            <div class=\"row\">\r\n                                <label>\r\n                                    歌名\r\n                                </label>\r\n                                <input type=\"text\" name=\"name\" value=\"__name__\">\r\n                            </div>\r\n                            <div class=\"row\">\r\n                                <label>\r\n                                    歌手\r\n                                </label>\r\n                                <input type=\"text\" name=\"singer\" value=\"__singer__\">\r\n                            </div>\r\n                            <div class=\"row\">\r\n                                <label>\r\n                                    外链\r\n                                </label>\r\n                                <input type=\"text\" name=\"url\" value=\"__url__\">\r\n                            </div>\r\n                            <div class=\"row\">\r\n                                <label>\r\n                                    封面\r\n                                </label>\r\n                                <input type=\"text\" name=\"cover\" value=\"__cover__\">\r\n                            </div>\r\n                        </div>\r\n                        <div class=\"right-row\">\r\n                            <div class=\"row\">\r\n                                <label>\r\n                                    歌词\r\n                                </label>\r\n                                <textarea name=\"lyrics\" id=\"song-lyrics\">__lyrics__</textarea>\r\n                                <!--<input type=\"text\" name=\"lyrics\" value=\"__lyrics__\">-->\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"row actions\">\r\n                        <button type=\"submit\">保存</button>\r\n                    </div>\r\n                </form>\r\n        `,\r\n        render(data = {}){\r\n            let placeholders = ['name','singer','lyrics','url','cover']\r\n            let htmlString = this.template\r\n            placeholders.map((string)=>{\r\n                htmlString = htmlString.replace(`__${string}__`, data[string] || '')\r\n            })\r\n            $(this.el).html(htmlString)\r\n            this.toggleNewAndEdit(data.id)\r\n        },\r\n        reset(){\r\n            this.render({})\r\n        },\r\n        show(){\r\n            $(this.el).removeClass('hide')\r\n        },\r\n        hide(){\r\n            $(this.el).addClass('hide')\r\n        },\r\n        toggleNewAndEdit(data){\r\n            if(data){\r\n                $(this.el).find('.form').prepend('<h3>编辑歌曲</h3>')\r\n            }else{\r\n                $(this.el).find('.form').prepend('<h3>新建歌曲</h3>')\r\n            }\r\n        },\r\n        setCover(cover){\r\n            $(this.el).find('img').attr('src', cover)\r\n        }\r\n    }\r\n    let model = {\r\n        data: { name:'',singer:'',url:'',id:'',lyrics:'',cover:''},\r\n        create(data){\r\n            console.log('创建数据');\r\n            // 声明类型\r\n            let Song = AV.Object.extend('Song');\r\n            // 新建对象\r\n            let song = new Song();\r\n            // 设置名称\r\n            song.set('name', data.name);\r\n            // 设置优先级\r\n            song.set('singer',data.singer);\r\n            song.set('url',data.url);\r\n            song.set('cover',data.cover);\r\n            song.set('lyrics',data.lyrics);\r\n            return song.save().then((res)=>{\r\n                console.log(res);\r\n                let {id, attributes} = res\r\n                console.log(id,attributes)\r\n                Object.assign(this.data, {\r\n                    id,\r\n                    name: attributes.name,\r\n                    singer: attributes.singer,\r\n                    url: attributes.url,\r\n                    cover: attributes.cover,\r\n                    lyrics: attributes.lyrics\r\n                })\r\n            }, (error)=>{\r\n                console.error(error);\r\n            });\r\n        },\r\n        update(data){\r\n            console.log('更新数据');\r\n            // 第一个参数是 className，第二个参数是 objectId\r\n            var song = AV.Object.createWithoutData('Song', this.data.id);\r\n            // 修改属性\r\n            song.set('name', data.name);\r\n            song.set('singer', data.singer);\r\n            song.set('url', data.url);\r\n            song.set('cover',data.cover);\r\n            song.set('lyrics',data.lyrics);\r\n            // 保存到云端\r\n            return song.save();\r\n        }\r\n    }\r\n    let controller = {\r\n        init(view, model){\r\n            this.view = view\r\n            this.model = model\r\n            this.view.render(this.model.data)\r\n            this.bindEvents()\r\n            this.bindEventHub()\r\n            window.eventHub.on('upload', (data)=>{\r\n                //song-form接收到上传歌曲的信息并重新渲染form内容\r\n                this.reset(data)\r\n            })\r\n        },\r\n        reset(data){\r\n            this.view.render(data)\r\n        },\r\n        bindEvents(){\r\n            console.log($(this.view.el));\r\n            $(this.view.el).on('submit', 'form', (e)=>{\r\n                //点击保存后收集form中的数据\r\n                e.preventDefault()\r\n                let needs = 'name singer url cover lyrics'.split(' ')\r\n                let data = {}\r\n                needs.map((item)=>{\r\n                    data[item] = $(this.view.el).find(`[name=${item}]`).val()\r\n                })\r\n                //收集数据后，判断是更新还是新建数据\r\n                if(this.model.data.id){\r\n                    this.model.update(data).then((res)=>{\r\n                        console.log('更新成功');\r\n                        console.log(res);\r\n                        Object.assign(data, {\r\n                            id: res.id,\r\n                            name: res.attributes.name,\r\n                            singer: res.attributes.singer,\r\n                            url: res.attributes.url,\r\n                            cover: res.attributes.cover,\r\n                            lyrics: res.attributes.lyrics\r\n                        })\r\n                        window.eventHub.emit('update', JSON.parse(JSON.stringify(data)))\r\n                        this.model.data = { name:'',singer:'',url:'',id:'',lyrics:'',cover:''}\r\n                        this.view.hide()\r\n                    })\r\n                }else {\r\n                    this.model.create(data).then(()=>{\r\n                        this.view.reset()\r\n                        let newSong = JSON.parse(JSON.stringify(this.model.data))\r\n                        console.log(newSong);\r\n                        window.eventHub.emit('save', newSong)\r\n                        this.model.data = { name:'',singer:'',url:'',id:'',lyrics:'',cover:''}\r\n                    })\r\n                }\r\n            })\r\n        },\r\n        bindEventHub(){\r\n            window.eventHub.on('new', ()=>{\r\n                this.view.hide()\r\n            })\r\n            window.eventHub.on('upload', ()=>{\r\n                this.view.show()\r\n            })\r\n            window.eventHub.on('select', (data)=>{\r\n                console.log('song-form接收到select事件');\r\n                console.log(data);\r\n                Object.assign(this.model.data, data)\r\n                this.view.show()\r\n                this.view.render(this.model.data)\r\n                console.log(this.model.data);\r\n                this.view.setCover(this.model.data.cover)\r\n            })\r\n            window.eventHub.on('save', ()=>{\r\n                this.view.hide()\r\n            })\r\n        }\r\n    }\r\n    controller.init(view, model)\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/js/song-form.js"],"sourceRoot":""}