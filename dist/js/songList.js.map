{"version":3,"sources":["webpack:///webpack/bootstrap 9a8817807c60f270cfbd","webpack:///./src/js/song-list.js"],"names":["console","log","view","el","template","render","data","$","empty","songs","selectedId","html","liList","map","song","$li","id","url","name","singer","addClass","domLi","find","append","model","undefined","query","AV","Query","then","songData","attributes","cover","lyrics","push","delete","Object","createWithoutData","destroy","success","error","controller","init","window","eventHub","on","bindEvents","bindEventHub","e","liId","currentTarget","parents","attr","emit","JSON","parse","stringify","alertify","confirm","res","set","ok","cancel","newSongs"],"mappings":"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","file":"songList.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 17);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 9a8817807c60f270cfbd","console.log('song list');\r\n\r\n{\r\n    let view = {\r\n        el: '.songList-container',\r\n        template: `\r\n            <h3>歌曲列表</h3>\r\n            <ul class=\"song-list\"></ul>\r\n        `,\r\n        render(data){\r\n            $(this.el).empty()\r\n            let {songs, selectedId} = data\r\n            $(this.el).html(this.template)\r\n            let liList = songs.map((song)=>{\r\n                let $li = $(`\r\n                    <li song-data-id=\"${song.id}\">\r\n                        <a href=\"${song.url}\" target=\"_blank\">\r\n                            <svg class=\"icon play\" aria-hidden=\"true\">\r\n                                <use xlink:href=\"#icon-play2\"></use>\r\n                            </svg>\r\n                        </a>\r\n                        <div class=\"song\">\r\n                            <div class=\"li-song-info\">\r\n                                <svg class=\"icon name\" aria-hidden=\"true\">\r\n                                    <use xlink:href=\"#icon-name\"></use>\r\n                                </svg>\r\n                                <span class=\"song-name\">${song.name}</span>\r\n                                <svg class=\"icon singer\" aria-hidden=\"true\">\r\n                                    <use xlink:href=\"#icon-singer\"></use>\r\n                                </svg>\r\n                                <span class=\"song-singer\">${song.singer}</span>\r\n                            </div>\r\n                            <div class=\"li-song-actions\">\r\n                                <svg id=\"edit\" class=\"icon edit\" aria-hidden=\"true\">\r\n                                    <use xlink:href=\"#icon-edit\"></use>\r\n                                </svg>\r\n                                <svg id=\"delete\" class=\"icon delete\" aria-hidden=\"true\">\r\n                                    <use xlink:href=\"#icon-delete\"></use>\r\n                                </svg>\r\n                            </div>\r\n                        </div>\r\n                    </li>\r\n                `)\r\n                if(song.id === selectedId){\r\n                    $li.addClass('active')\r\n                }\r\n                return $li\r\n            })\r\n            liList.map((domLi)=>{\r\n                $(this.el).find('.song-list').append(domLi)\r\n            })\r\n        }\r\n    }\r\n    let model = {\r\n        data: {\r\n            songs:[],\r\n            selectedId: undefined\r\n        },\r\n        find(){\r\n            let query = new AV.Query('Song')\r\n            return query.find().then((songs)=>{\r\n                //songs是所有歌曲，是一个数组，下面从数组每一项的对象中获取歌曲数据\r\n                songs.map((song)=>{\r\n                    let songData = {\r\n                        id: song.id,\r\n                        name: song.attributes.name,\r\n                        singer: song.attributes.singer,\r\n                        url: song.attributes.url,\r\n                        cover: song.attributes.cover,\r\n                        lyrics: song.attributes.lyrics\r\n                    }\r\n                    this.data.songs.push(songData)\r\n                })\r\n            })\r\n        },\r\n        delete(data){\r\n            let song = AV.Object.createWithoutData('Song', data);\r\n            return song.destroy().then((success)=>{\r\n                // 删除成功\r\n                console.log('删除成功');\r\n            }, (error)=>{\r\n                // 删除失败\r\n            });\r\n        }\r\n    }\r\n    let controller = {\r\n        init(view,model){\r\n            this.view = view\r\n            this.model = model\r\n            this.view.render(this.model.data)\r\n            window.eventHub.on('save', (data)=>{\r\n                this.model.data.songs.push(data)\r\n                this.view.render(this.model.data)\r\n            })\r\n            this.model.find().then(()=>{\r\n                this.view.render(this.model.data)\r\n                this.bindEvents()\r\n                this.bindEventHub()\r\n            })\r\n        },\r\n        bindEvents(){\r\n            $(this.view.el).on('click', '.edit', (e)=>{\r\n                let liId = $(e.currentTarget).parents('li').attr('song-data-id')\r\n                this.model.data.selectedId = liId\r\n                this.view.render(this.model.data)\r\n                let data\r\n                let {songs} = this.model.data\r\n                songs.map((song)=>{\r\n                    if(song.id === this.model.data.selectedId){\r\n                        data = song\r\n                    }\r\n                })\r\n                window.eventHub.emit('select', JSON.parse(JSON.stringify(data)))\r\n            })\r\n            $(this.view.el).on('click', '.delete', (e)=>{\r\n\r\n                alertify.confirm(\"警告!\",\"确认删除此歌曲？\",\r\n                        ()=>{\r\n                            alertify.success('成功删除');\r\n                            let liId = $(e.currentTarget).parents('li').attr('song-data-id')\r\n                            console.log(this.model.data);\r\n                            this.model.delete(liId).then((res)=>{\r\n                                console.log(res);\r\n                                this.model.data = {songs:[], selectedId: undefined}\r\n                                this.init(view,model)\r\n                            })\r\n                        },\r\n                        ()=>{\r\n                            alertify.error('取消');\r\n                        }).set('labels', {ok:'删除', cancel:'取消'}); ;\r\n            })\r\n        },\r\n        bindEventHub(){\r\n            window.eventHub.on('new', ()=>{\r\n                this.model.data.selectedId = undefined\r\n                this.view.render(this.model.data)\r\n            })\r\n            window.eventHub.on('update', (data)=>{\r\n                console.log(this.model.data);\r\n                let {songs} = this.model.data\r\n                let newSongs = songs.map((song)=>{\r\n                    if(song.id === data.id){\r\n                        song = data\r\n                    }\r\n                    return song\r\n                })\r\n                this.model.data.songs = newSongs\r\n                this.model.data.selectedId = undefined\r\n                this.view.render(this.model.data)\r\n\r\n            })\r\n        }\r\n    }\r\n    controller.init(view, model)\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/song-list.js"],"sourceRoot":""}